<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOND â€” Installation Wizard</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=Outfit:wght@300;400;500;600;700&display=swap');

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg-deep:     #0d1117;
    --bg-surface:  #161b22;
    --bg-elevated: #1c2333;
    --bg-hover:    #21283b;
    --border:      #30363d;
    --border-focus:#58a6ff;
    --text-primary:   #e6edf3;
    --text-secondary: #8b949e;
    --text-muted:     #484f58;
    --accent:      #e94560;
    --accent-dim:  #e9456022;
    --amber:       #d29922;
    --amber-dim:   #d2992215;
    --amber-glow:  #d2992240;
    --teal:        #56d4dd;
    --teal-dim:    #56d4dd15;
    --green:       #3fb950;
    --green-dim:   #3fb95015;
    --font-mono:   'JetBrains Mono', 'Consolas', monospace;
    --font-ui:     'Outfit', -apple-system, sans-serif;
    --radius-sm: 4px;
    --radius-md: 8px;
    --radius-lg: 12px;
  }

  html, body {
    height: 100%;
    font-family: var(--font-ui);
    background: var(--bg-deep);
    color: var(--text-primary);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
  }

  body {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    background:
      radial-gradient(ellipse at 20% 50%, rgba(210,153,34,0.04) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 50%, rgba(86,212,221,0.03) 0%, transparent 50%),
      var(--bg-deep);
  }

  .wizard { width: 100%; max-width: 720px; min-height: 500px; display: flex; flex-direction: column; }

  .wizard-header { text-align: center; margin-bottom: 32px; }
  .wizard-logo { font-size: 2.4rem; letter-spacing: -2px; margin-bottom: 4px; animation: fadeInDown 0.6s ease; }
  .wizard-title { font-size: 1.6rem; font-weight: 700; letter-spacing: 2px; color: var(--amber); animation: fadeInDown 0.6s ease 0.1s both; }
  .wizard-subtitle { font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-muted); margin-top: 4px; animation: fadeInDown 0.6s ease 0.2s both; }

  .progress-bar { display: flex; align-items: center; justify-content: center; gap: 0; margin-bottom: 28px; animation: fadeIn 0.5s ease 0.3s both; }
  .step-dot { width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-size: 0.7rem; font-weight: 600; border: 2px solid var(--border); color: var(--text-muted); background: var(--bg-surface); transition: all 0.3s ease; }
  .step-dot.active { border-color: var(--amber); color: var(--amber); background: var(--amber-dim); box-shadow: 0 0 12px var(--amber-glow); }
  .step-dot.done { border-color: var(--green); color: var(--green); background: var(--green-dim); }
  .step-line { width: 48px; height: 2px; background: var(--border); transition: background 0.3s ease; }
  .step-line.done { background: var(--green); }

  .wizard-card { background: var(--bg-surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 28px 32px; flex: 1; animation: fadeInUp 0.4s ease; }
  .card-title { font-size: 1.15rem; font-weight: 600; margin-bottom: 4px; }
  .card-desc { font-size: 0.82rem; color: var(--text-secondary); margin-bottom: 20px; }

  .welcome-features { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
  .welcome-feature { display: flex; align-items: flex-start; gap: 10px; padding: 12px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 0.8rem; color: var(--text-secondary); }
  .welcome-feature-icon { font-size: 1.1rem; flex-shrink: 0; margin-top: 1px; }
  .welcome-feature-text strong { color: var(--text-primary); display: block; font-size: 0.82rem; margin-bottom: 2px; }

  .component-list { display: flex; flex-direction: column; gap: 8px; margin-bottom: 6px; }
  .component { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-md); cursor: pointer; transition: all 0.15s ease; user-select: none; }
  .component:hover { border-color: var(--border-focus); }
  .component.selected { border-color: var(--amber); background: var(--amber-dim); }
  .component.required { border-color: rgba(210,153,34,0.3); }
  .component-check { width: 20px; height: 20px; border-radius: var(--radius-sm); border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 0.7rem; flex-shrink: 0; transition: all 0.15s ease; }
  .component.selected .component-check { border-color: var(--amber); background: var(--amber); color: var(--bg-deep); }
  .component.required .component-check { border-color: var(--amber); background: rgba(210,153,34,0.3); color: var(--amber); }
  .component-info { flex: 1; }
  .component-name { font-weight: 600; font-size: 0.88rem; }
  .component-desc { font-size: 0.72rem; color: var(--text-muted); font-family: var(--font-mono); }
  .component-badge { font-family: var(--font-mono); font-size: 0.6rem; font-weight: 600; padding: 2px 8px; border-radius: var(--radius-sm); text-transform: uppercase; letter-spacing: 0.5px; }
  .badge-required { background: rgba(210,153,34,0.15); color: var(--amber); border: 1px solid rgba(210,153,34,0.3); }
  .badge-optional { background: rgba(86,212,221,0.1); color: var(--teal); border: 1px solid rgba(86,212,221,0.2); }
  .badge-recommended { background: rgba(63,185,80,0.1); color: var(--green); border: 1px solid rgba(63,185,80,0.3); }

  .path-group { margin-bottom: 16px; }
  .path-label { font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
  .path-input { width: 100%; padding: 10px 14px; background: var(--bg-deep); border: 1px solid var(--border); border-radius: var(--radius-sm); color: var(--text-primary); font-family: var(--font-mono); font-size: 0.82rem; outline: none; transition: border-color 0.15s ease; }
  .path-input:focus { border-color: var(--amber); }
  .path-hint { font-family: var(--font-mono); font-size: 0.65rem; color: var(--text-muted); margin-top: 4px; }

  .review-section { margin-bottom: 16px; }
  .review-label { font-family: var(--font-mono); font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; }
  .review-items { display: flex; flex-wrap: wrap; gap: 6px; }
  .review-item { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-sm); font-family: var(--font-mono); font-size: 0.75rem; color: var(--text-secondary); }
  .review-path { padding: 8px 12px; background: var(--bg-deep); border: 1px solid var(--border); border-radius: var(--radius-sm); font-family: var(--font-mono); font-size: 0.78rem; color: var(--teal); word-break: break-all; }
  .script-preview { background: var(--bg-deep); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 16px; font-family: var(--font-mono); font-size: 0.72rem; color: var(--text-secondary); line-height: 1.7; max-height: 260px; overflow-y: auto; white-space: pre; margin-top: 12px; }

  .complete-icon { font-size: 3rem; text-align: center; margin-bottom: 12px; animation: popIn 0.5s ease; }
  .complete-title { text-align: center; font-size: 1.3rem; font-weight: 700; color: var(--green); margin-bottom: 6px; }
  .complete-desc { text-align: center; font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 20px; }
  .next-steps { display: flex; flex-direction: column; gap: 8px; }
  .next-step { display: flex; align-items: flex-start; gap: 10px; padding: 10px 14px; background: var(--bg-elevated); border: 1px solid var(--border); border-radius: var(--radius-md); font-size: 0.8rem; color: var(--text-secondary); }
  .next-step-num { width: 22px; height: 22px; border-radius: 50%; background: var(--amber-dim); border: 1px solid rgba(210,153,34,0.3); color: var(--amber); display: flex; align-items: center; justify-content: center; font-family: var(--font-mono); font-size: 0.65rem; font-weight: 600; flex-shrink: 0; }
  .next-step code { font-family: var(--font-mono); background: var(--bg-deep); padding: 1px 6px; border-radius: 3px; font-size: 0.75rem; color: var(--teal); }

  .mcp-block { background: var(--bg-deep); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 14px; font-family: var(--font-mono); font-size: 0.72rem; color: var(--teal); line-height: 1.7; white-space: pre; margin-top: 12px; max-height: 200px; overflow-y: auto; position: relative; }
  .copy-btn { position: absolute; top: 8px; right: 8px; background: var(--bg-elevated); border: 1px solid var(--border); color: var(--text-secondary); padding: 4px 10px; border-radius: var(--radius-sm); font-family: var(--font-mono); font-size: 0.65rem; cursor: pointer; }
  .copy-btn:hover { color: var(--amber); border-color: var(--amber); }

  .wizard-footer { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
  .btn { padding: 10px 24px; font-family: var(--font-mono); font-size: 0.82rem; font-weight: 500; border-radius: var(--radius-md); cursor: pointer; transition: all 0.15s ease; border: 1px solid; }
  .btn-back { background: transparent; color: var(--text-secondary); border-color: var(--border); }
  .btn-back:hover { background: var(--bg-hover); color: var(--text-primary); }
  .btn-next { background: var(--amber-dim); color: var(--amber); border-color: rgba(210,153,34,0.5); font-weight: 600; }
  .btn-next:hover { background: rgba(210,153,34,0.2); box-shadow: 0 0 16px var(--amber-glow); }
  .btn-download { background: rgba(63,185,80,0.1); color: var(--green); border-color: rgba(63,185,80,0.4); font-weight: 600; }
  .btn-download:hover { background: rgba(63,185,80,0.2); box-shadow: 0 0 16px rgba(63,185,80,0.2); }
  .btn:disabled { opacity: 0.35; cursor: not-allowed; }

  @keyframes fadeInDown { from { opacity: 0; transform: translateY(-12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeInUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
  @keyframes popIn { 0% { opacity: 0; transform: scale(0.5); } 70% { transform: scale(1.1); } 100% { opacity: 1; transform: scale(1); } }

  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: var(--bg-deep); }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 3px; }
</style>
</head>
<body>

<div class="wizard" id="wizard">
  <div class="wizard-header">
    <div class="wizard-logo">ğŸ”¥ğŸŒŠ</div>
    <div class="wizard-title">BOND</div>
    <div class="wizard-subtitle">Installation Wizard v2.0</div>
  </div>
  <div class="progress-bar" id="progress"></div>
  <div class="wizard-card" id="card"></div>
  <div class="wizard-footer" id="footer"></div>
</div>

<script>
const STEPS = ['Welcome', 'Components', 'Configure', 'Review', 'MCP Config', 'Complete'];
let step = 0;

const state = {
  components: {
    panel:    { selected: true,  required: true,  name: 'Control Panel',    desc: 'React dashboard + Express sidecar + tool auth', icon: 'ğŸ–¥ï¸' },
    qais:    { selected: true,  required: false, name: 'QAIS Memory',      desc: 'Resonance storage, heat map, crystal persistence', icon: 'ğŸ”®', badge: 'recommended' },
    iss:     { selected: true,  required: false, name: 'ISS Analysis',     desc: 'Semantic force measurement + limbic perception', icon: 'ğŸ§ ', badge: 'recommended' },
    ahk:     { selected: true,  required: false, name: 'AHK Bridge',       desc: 'Clipboard bridge + counter (Windows)', icon: 'ğŸ”—' },
    starter: { selected: true,  required: false, name: 'Starter Entities',  desc: 'BOND_MASTER doctrine + reference library template', icon: 'ğŸ“¦' },
    sla:     { selected: true,  required: false, name: 'SLA Retrieval',     desc: 'Spectral Lexical Addressing â€” deterministic text retrieval', icon: 'ğŸ”' },
    skills:  { selected: true,  required: false, name: 'Claude Skill',      desc: 'BOND protocol skill file for Claude', icon: 'ğŸ¯' },
    docs:    { selected: true,  required: false, name: 'Documentation',     desc: 'Commands, entities, counter, search reference', icon: 'ğŸ“–' },
  },
  paths: {
    install: 'C:\\BOND',
    port: '3000',
  },
};

function render() {
  renderProgress();
  renderCard();
  renderFooter();
}

function renderProgress() {
  const el = document.getElementById('progress');
  let html = '';
  STEPS.forEach((s, i) => {
    const cls = i < step ? 'done' : i === step ? 'active' : '';
    const icon = i < step ? 'âœ“' : i + 1;
    html += `<div class="step-dot ${cls}">${icon}</div>`;
    if (i < STEPS.length - 1) html += `<div class="step-line ${i < step ? 'done' : ''}"></div>`;
  });
  el.innerHTML = html;
}

function renderFooter() {
  const el = document.getElementById('footer');
  if (step === 0) {
    el.innerHTML = `<div></div><button class="btn btn-next" onclick="next()">Get Started â†’</button>`;
  } else if (step === STEPS.length - 1) {
    el.innerHTML = `<div></div><button class="btn btn-next" onclick="window.location.reload()">Start Over</button>`;
  } else if (step === 3) {
    el.innerHTML = `
      <button class="btn btn-back" onclick="prev()">â† Back</button>
      <div style="display:flex;gap:8px;">
        <button class="btn btn-download" onclick="downloadScript()">â¬‡ Download install.bat</button>
        <button class="btn btn-next" onclick="next()">Continue â†’</button>
      </div>`;
  } else {
    el.innerHTML = `
      <button class="btn btn-back" onclick="prev()">â† Back</button>
      <button class="btn btn-next" onclick="next()">Continue â†’</button>`;
  }
}

function renderCard() {
  const el = document.getElementById('card');
  el.style.animation = 'none'; el.offsetHeight; el.style.animation = 'fadeInUp 0.35s ease';
  switch(step) {
    case 0: return renderWelcome(el);
    case 1: return renderComponents(el);
    case 2: return renderConfigure(el);
    case 3: return renderReview(el);
    case 4: return renderMCPConfig(el);
    case 5: return renderComplete(el);
  }
}

// â”€â”€â”€ Step 0: Welcome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderWelcome(el) {
  el.innerHTML = `
    <div class="card-title">Welcome to BOND</div>
    <div class="card-desc">Persistence and continuity framework for human-AI collaboration.</div>
    <div class="welcome-features">
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ–¥ï¸</span><div class="welcome-feature-text"><strong>Control Panel</strong>Dark-themed dashboard for entities, modules, and commands.</div></div>
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ”®</span><div class="welcome-feature-text"><strong>QAIS Memory</strong>Resonance-based persistent context across sessions.</div></div>
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ§ </span><div class="welcome-feature-text"><strong>ISS Analysis</strong>Semantic force measurement and limbic perception.</div></div>
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ“œ</span><div class="welcome-feature-text"><strong>Entity System</strong>Four-class architecture: Doctrine, Project, Perspective, Library.</div></div>
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ”—</span><div class="welcome-feature-text"><strong>Clipboard Bridge</strong>Panel â†’ AHK â†’ Claude. Seamless command relay.</div></div>
      <div class="welcome-feature"><span class="welcome-feature-icon">ğŸ”</span><div class="welcome-feature-text"><strong>SLA Retrieval</strong>Deterministic spectral text retrieval in the panel.</div></div>
    </div>
    <div style="font-size:0.75rem;color:var(--text-muted);font-family:var(--font-mono);text-align:center;">
      Requirements: Node.js 18+ Â· Python 3.8+ Â· numpy Â· Git Â· Windows 10/11 (for AHK bridge)
    </div>`;
}

// â”€â”€â”€ Step 1: Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderComponents(el) {
  let html = `
    <div class="card-title">Choose Components</div>
    <div class="card-desc">The Control Panel is required. QAIS and ISS are recommended for full functionality.</div>
    <div class="component-list">`;
  for (const [key, comp] of Object.entries(state.components)) {
    const cls = comp.required ? 'required selected' : comp.selected ? 'selected' : '';
    const badgeCls = comp.required ? 'badge-required' : comp.badge === 'recommended' ? 'badge-recommended' : 'badge-optional';
    const badgeText = comp.required ? 'Required' : comp.badge === 'recommended' ? 'Recommended' : 'Optional';
    html += `
      <div class="component ${cls}" onclick="${comp.required ? '' : `toggleComponent('${key}')`}">
        <div class="component-check">${comp.selected || comp.required ? 'âœ“' : ''}</div>
        <span style="font-size:1.1rem">${comp.icon}</span>
        <div class="component-info"><div class="component-name">${comp.name}</div><div class="component-desc">${comp.desc}</div></div>
        <span class="component-badge ${badgeCls}">${badgeText}</span>
      </div>`;
  }
  html += '</div>';
  el.innerHTML = html;
}

function toggleComponent(key) { state.components[key].selected = !state.components[key].selected; renderCard(); }

// â”€â”€â”€ Step 2: Configure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderConfigure(el) {
  const c = state.components;
  el.innerHTML = `
    <div class="card-title">Configure Paths</div>
    <div class="card-desc">Set your installation directory and panel port.</div>
    <div class="path-group">
      <div class="path-label">ğŸ“‚ Install Directory</div>
      <input class="path-input" type="text" value="${escapeHtml(state.paths.install)}" oninput="state.paths.install = this.value" />
      <div class="path-hint">All BOND components will be installed inside this directory</div>
    </div>
    <div class="path-group">
      <div class="path-label">ğŸŒ Panel Port</div>
      <input class="path-input" type="text" value="${state.paths.port}" oninput="state.paths.port = this.value" style="width:120px;" />
      <div class="path-hint">Express sidecar port (default: 3000)</div>
    </div>
    <div style="margin-top:16px;padding:12px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);font-size:0.78rem;color:var(--text-secondary);">
      <strong style="color:var(--amber)">ğŸ“‹ Directory structure:</strong>
      <pre style="margin-top:8px;font-family:var(--font-mono);font-size:0.72rem;color:var(--text-muted);line-height:1.8;">${escapeHtml(state.paths.install)}\\
â”œâ”€â”€ panel\\          â† React dashboard + Express server
â”œâ”€â”€ doctrine\\       â† Entity files (your knowledge domains)
â”œâ”€â”€ state\\          â† Active entity pointer
â”œâ”€â”€ data\\           â† QAIS field storage${c.qais.selected ? `
â”œâ”€â”€ QAIS\\           â† QAIS MCP server` : ''}${c.iss.selected ? `
â”œâ”€â”€ ISS\\            â† ISS MCP server` : ''}${c.sla.selected ? `
â”œâ”€â”€ SLA\\            â† Spectral Lexical Addressing` : ''}${c.skills.selected ? `
â”œâ”€â”€ skills\\         â† Claude skill file` : ''}${c.ahk.selected ? `
â”œâ”€â”€ bridge\\         â† AHK automation script` : ''}${c.docs.selected ? `
â”œâ”€â”€ docs\\           â† Reference documentation` : ''}
â””â”€â”€ .env             â† Configuration</pre>
    </div>`;
}

// â”€â”€â”€ Step 3: Review â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReview(el) {
  const selected = Object.entries(state.components).filter(([k,v]) => v.selected || v.required);
  el.innerHTML = `
    <div class="card-title">Review &amp; Download</div>
    <div class="card-desc">Confirm your selections, then download the install script.</div>
    <div class="review-section">
      <div class="review-label">Components</div>
      <div class="review-items">${selected.map(([k,v]) => `<span class="review-item"><span class="ri-icon">${v.icon}</span> ${v.name}</span>`).join('')}</div>
    </div>
    <div class="review-section">
      <div class="review-label">Install Path</div>
      <div class="review-path">${escapeHtml(state.paths.install)}</div>
    </div>
    <div class="review-section">
      <div class="review-label">Port</div>
      <div class="review-path" style="display:inline-block;">${escapeHtml(state.paths.port)}</div>
    </div>
    <div class="review-section">
      <div class="review-label">Generated Script Preview</div>
      <div class="script-preview">${escapeHtml(generateScript())}</div>
    </div>`;
}

// â”€â”€â”€ Step 4: MCP Config â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderMCPConfig(el) {
  const p = state.paths.install.replace(/\\/g, '/');
  const c = state.components;
  let mcpConfig = { mcpServers: {} };

  if (c.qais.selected) {
    mcpConfig.mcpServers.qais = {
      command: "python",
      args: [`${p}/QAIS/qais_mcp_server.py`],
      env: { BOND_ROOT: state.paths.install.replace(/\\/g, '\\\\') }
    };
  }
  if (c.iss.selected) {
    mcpConfig.mcpServers.iss = {
      command: "python",
      args: [`${p}/ISS/iss_mcp_server.py`],
      env: { BOND_ROOT: state.paths.install.replace(/\\/g, '\\\\') }
    };
  }

  const configJson = JSON.stringify(mcpConfig, null, 2);

  el.innerHTML = `
    <div class="card-title">MCP Server Configuration</div>
    <div class="card-desc">
      Add this to your Claude MCP configuration to connect the panel's module cards to the live servers.
      ${c.qais.selected || c.iss.selected ? '' : '<br><em style="color:var(--text-muted)">No MCP servers selected â€” skip this step.</em>'}
    </div>
    ${c.qais.selected || c.iss.selected ? `
    <div style="font-size:0.82rem;color:var(--text-secondary);margin-bottom:8px;">
      Add to your Claude Desktop or Claude.ai MCP settings:
    </div>
    <div class="mcp-block" id="mcpBlock">
      <button class="copy-btn" onclick="copyMCP()">Copy</button>${escapeHtml(configJson)}
    </div>
    <div style="margin-top:12px;font-size:0.75rem;color:var(--text-muted);font-family:var(--font-mono);">
      Paths use your install directory. Adjust if needed for your MCP client.
    </div>` : ''}
    <div style="margin-top:16px;padding:12px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);font-size:0.78rem;color:var(--text-secondary);">
      <strong style="color:var(--amber);">ğŸ’¡ Note:</strong> The panel's module cards will show server status
      once MCP servers are running. The panel communicates through the Express sidecar â€”
      tool authorization is enforced at the API layer regardless of how Claude connects.
    </div>`;
}

function copyMCP() {
  const block = document.getElementById('mcpBlock');
  const text = block.textContent.replace('Copy', '').trim();
  navigator.clipboard.writeText(text).then(() => {
    const btn = block.querySelector('.copy-btn');
    btn.textContent = 'Copied!';
    setTimeout(() => btn.textContent = 'Copy', 2000);
  });
}

// â”€â”€â”€ Step 5: Complete â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderComplete(el) {
  const c = state.components;
  el.innerHTML = `
    <div class="complete-icon">ğŸ”¥ğŸŒŠ</div>
    <div class="complete-title">BOND is Ready</div>
    <div class="complete-desc">Run the downloaded install.bat to set up your system.</div>
    <div class="next-steps">
      <div class="next-step"><div class="next-step-num">1</div><div>Run <code>install.bat</code> â€” it clones the repo, installs dependencies, and creates your environment.</div></div>
      <div class="next-step"><div class="next-step-num">2</div><div>Start BOND with <code>start_bond.bat</code></div></div>
      <div class="next-step"><div class="next-step-num">3</div><div>Open <code>http://localhost:${state.paths.port}</code> to see the Control Panel.</div></div>
      ${c.ahk.selected ? `<div class="next-step"><div class="next-step-num">4</div><div>Run <code>bridge\\BOND_v8.ahk</code> to start the counter + command bridge (requires <a href="https://www.autohotkey.com/" style="color:var(--teal)">AutoHotkey</a>).</div></div>` : ''}
      <div class="next-step"><div class="next-step-num">${c.ahk.selected ? '5' : '4'}</div><div>${c.skills.selected ? `Add the BOND skill from <code>skills\\bond\\SKILL.md</code> to your Claude project, then type` : 'Type'} <code>{Full Restore}</code> in Claude to initialize. Welcome aboard. ğŸ”¥ğŸŒŠ</div></div>
    </div>`;
}

// â”€â”€â”€ Script Generator â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateScript() {
  const p = state.paths.install;
  const c = state.components;
  const port = state.paths.port;

  let s = `@echo off
:: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
:: BOND Installation Script v2.0
:: Generated by BOND Wizard
:: â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo  ğŸ”¥ğŸŒŠ BOND Installer
echo  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.

set "BOND_ROOT=${p}"
set "BOND_PORT=${port}"

:: â”€â”€â”€ Prerequisites â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [1/7] Checking prerequisites...
where node >nul 2>nul || (
    echo [MISSING] Node.js â€” Install from https://nodejs.org
    pause & exit /b 1
)
echo    [OK] Node.js found`;

  if (c.qais.selected || c.iss.selected) {
    s += `
where python >nul 2>nul || (
    echo [MISSING] Python â€” Install from https://python.org
    pause & exit /b 1
)
echo    [OK] Python found
python -c "import numpy" >nul 2>nul || (
    echo    Installing numpy...
    pip install numpy
)
echo    [OK] numpy available`;
  }

  s += `
echo.

:: â”€â”€â”€ Create Directory Structure â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [2/7] Creating directory structure...
mkdir "%BOND_ROOT%" 2>nul
mkdir "%BOND_ROOT%\\panel" 2>nul
mkdir "%BOND_ROOT%\\doctrine" 2>nul
mkdir "%BOND_ROOT%\\state" 2>nul
mkdir "%BOND_ROOT%\\data" 2>nul`;

  if (c.ahk.selected) s += `\nmkdir "%BOND_ROOT%\\bridge" 2>nul`;
  if (c.skills.selected) s += `\nmkdir "%BOND_ROOT%\\skills\\bond" 2>nul`;
  if (c.docs.selected) s += `\nmkdir "%BOND_ROOT%\\docs" 2>nul`;

  s += `
echo    Done.
echo.

:: â”€â”€â”€ Clone Repository â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [3/7] Cloning BOND repository...
cd /d "%BOND_ROOT%"
git clone https://github.com/moneyjarrod/BOND.git _repo_temp 2>nul
if not exist "_repo_temp\\panel" (
    echo    âš  Could not clone repo. Check git and network.
    pause & exit /b 1
)
echo    Repository cloned.
echo.

:: â”€â”€â”€ Install Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [4/7] Installing Control Panel...
xcopy /E /Y /Q "_repo_temp\\panel\\*" "panel\\" >nul
cd /d "%BOND_ROOT%\\panel"
call npm install
echo    Panel installed.
echo.

:: â”€â”€â”€ Write Configuration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [5/7] Writing configuration...
(
  echo BOND_ROOT=%BOND_ROOT%
  echo DOCTRINE_PATH=%BOND_ROOT%\\doctrine
  echo STATE_PATH=%BOND_ROOT%\\state
  echo PORT=%BOND_PORT%
  echo MCP_URL=http://localhost:3002
) > "%BOND_ROOT%\\panel\\.env"

:: Initialize state
echo {"entity":null,"class":null,"path":null,"entered":null} > "%BOND_ROOT%\\state\\active_entity.json"
echo    Configuration written.
echo.

:: â”€â”€â”€ Copy Components â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo [6/7] Installing selected components...`;

  if (c.qais.selected) {
    s += `

:: QAIS Memory Server
mkdir "%BOND_ROOT%\\QAIS" 2>nul
xcopy /E /Y /Q "_repo_temp\\QAIS\\*" "%BOND_ROOT%\\QAIS\\" >nul
echo    [OK] QAIS Memory server installed`;
  }

  if (c.iss.selected) {
    s += `

:: ISS Analysis Server
mkdir "%BOND_ROOT%\\ISS" 2>nul
xcopy /E /Y /Q "_repo_temp\\ISS\\*" "%BOND_ROOT%\\ISS\\" >nul
echo    [OK] ISS Analysis server installed`;
  }

  if (c.sla.selected) {
    s += `

:: SLA Retrieval
mkdir "%BOND_ROOT%\\doctrine\\SLA" 2>nul
if exist "_repo_temp\\SLA" (
    xcopy /E /Y /Q "_repo_temp\\SLA\\*" "%BOND_ROOT%\\doctrine\\SLA\\" >nul
    echo    [OK] SLA doctrine entity installed
)`;
  }

  if (c.ahk.selected) {
    s += `

:: AHK Bridge
if exist "_repo_temp\\Counter\\BOND_v8.ahk" (
    copy /Y "_repo_temp\\Counter\\BOND_v8.ahk" "%BOND_ROOT%\\bridge\\BOND_v8.ahk" >nul
    echo    [OK] AHK bridge copied to bridge\\
) else (
    echo    âš  AHK bridge not found in repo
)`;
  }

  if (c.starter.selected) {
    s += `

:: Starter Entities â€” BOND_MASTER
mkdir "%BOND_ROOT%\\doctrine\\BOND_MASTER" 2>nul
(echo {"class":"doctrine","tools":{"filesystem":true,"iss":true},"display_name":"BOND Master"}) > "%BOND_ROOT%\\doctrine\\BOND_MASTER\\entity.json"
(
  echo # BOND Master Doctrine
  echo.
  echo Your system's constitutional authority. Add IS statements,
  echo protocol rules, and audit checklists here.
  echo.
  echo ## What BOND IS
  echo.
  echo ^<!-- Add your own IS statements. Anything in this entity is law. --^>
) > "%BOND_ROOT%\\doctrine\\BOND_MASTER\\BOND_MASTER.md"

:: Starter Entities â€” Reference Library
mkdir "%BOND_ROOT%\\doctrine\\_reference" 2>nul
(echo {"class":"library","tools":{"filesystem":true}}) > "%BOND_ROOT%\\doctrine\\_reference\\entity.json"
(
  echo # Reference Library
  echo.
  echo Drop reference documents here. Read-only knowledge shelf.
) > "%BOND_ROOT%\\doctrine\\_reference\\index.md"
echo    [OK] Starter entities created`;
  }

  if (c.skills.selected) {
    s += `

:: Claude Skill
if exist "_repo_temp\\skills\\bond\\SKILL.md" (
    copy /Y "_repo_temp\\skills\\bond\\SKILL.md" "%BOND_ROOT%\\skills\\bond\\SKILL.md" >nul
    echo    [OK] Claude skill file copied
)`;
  }

  if (c.docs.selected) {
    s += `

:: Documentation
if exist "_repo_temp\\docs" (
    xcopy /E /Y /Q "_repo_temp\\docs\\*" "%BOND_ROOT%\\docs\\" >nul
    echo    [OK] Documentation copied
)`;
  }

  s += `

:: â”€â”€â”€ Boot Scripts + Cleanup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
echo.
echo [7/7] Finalizing...

:: Copy boot scripts from repo
copy /Y "_repo_temp\\start_bond.bat" "%BOND_ROOT%\\start_bond.bat" >nul
copy /Y "_repo_temp\\stop_bond.bat" "%BOND_ROOT%\\stop_bond.bat" >nul
echo    [OK] Boot scripts installed

:: Cleanup temp
rmdir /S /Q "%BOND_ROOT%\\_repo_temp"
echo    [OK] Temp files cleaned

echo.
echo  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo  ğŸ”¥ğŸŒŠ BOND installation complete!
echo  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
echo.
echo  Start:   %BOND_ROOT%\\start_bond.bat
echo  Stop:    %BOND_ROOT%\\stop_bond.bat
echo  Panel:   http://localhost:%BOND_PORT%`;

  if (c.ahk.selected) {
    s += `\necho  Bridge:  %BOND_ROOT%\\bridge\\BOND_v8.ahk`;
  }

  s += `
echo.
echo  Next: Add MCP server config to Claude,
echo  then type {Full Restore} to initialize.
echo.
pause`;

  return s;
}

// â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function next() { if (step < STEPS.length - 1) { step++; render(); } }
function prev() { if (step > 0) { step--; render(); } }
function escapeHtml(s) { return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }
function downloadScript() {
  const blob = new Blob([generateScript()], { type: 'text/plain' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'install_bond.bat';
  a.click();
  URL.revokeObjectURL(a.href);
}

render();
</script>
</body>
</html>
